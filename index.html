<!DOCTYPE html>
<html>
<head>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }
        #canvas {
            position: absolute;
            top: 60px; /* space for the controls */
            left: 5px; /* very very small border */
            right: 5px; /* very very small border */
            bottom: 5px; /* very very small border */
            touch-action: none; /* to improve drawing on mobile devices */
            border: 1px solid black; /* black border */
        }
        #controls {
            position: fixed;
            top: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            background-color: #f8f8f8;
            padding: 10px 0;
        }
        #colorSelect, button {
            font-size: 1.2em; /* make the buttons and select bigger */
        }
    </style>
</head>
<body>

<div id="controls">
    <button id="getColorButton">Get Color</button>

    <select id="colorSelect" onchange="changeColor(this.value)">
        <option value="red" selected>Red</option>
        <option value="orange">Orange</option>
        <option value="yellow">Yellow</option>
        <option value="blue">Blue</option>
        <option value="green">Green</option>
        <option value="purple">Purple</option>
        <option value="brown">Brown</option>
        <option value="grey">Grey</option>
        <option value="black">Black</option>
    </select>

    <button onclick="resetCanvas()">Reset</button>
</div>

<canvas id="canvas"></canvas>

<script>
    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');

    // Set canvas size to window size
    canvas.width = window.innerWidth - 12; // subtracting the small border and the border of the canvas
    canvas.height = window.innerHeight - 72; // subtracting the small border, the controls height and the border of the canvas

    var painting = false;
    var color = 'red';
    var lines = [];
    var currentLine = [];

    function startDraw(e) {
        painting = true;
        currentLine = [];
        draw(e);
    }

    function endDraw() {
        painting = false;
        lines.push(currentLine);
        ctx.beginPath();
    }

    function draw(e) {
        if (!painting) return;
        ctx.lineWidth = 10;
        ctx.lineCap = 'round';
        ctx.strokeStyle = color;

        var rect = canvas.getBoundingClientRect();
        var x = e.clientX - rect.left;
        var y = e.clientY - rect.top;

        ctx.lineTo(x, y);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(x, y);

        currentLine.push({x: x, y: y, color: color});
    }

    function changeColor(newColor) {
        color = newColor;
    }

    function resetCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        lines = [];
    }

    function getAverageColor() {
        var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        var data = imageData.data;
        var r = 0, g = 0, b = 0;
        var count = 0;

        for (var i = 0; i < data.length; i += 4) {
            if (data[i] !== 0 || data[i + 1] !== 0 || data[i + 2] !== 0) { // exclude white pixels
                r += data[i];
                g += data[i + 1];
                b += data[i + 2];
                count++;
            }
        }

        r /= count;
        g /= count;
        b /= count;

        return [Math.round(r), Math.round(g), Math.round(b)];
    }

    function fillCanvasWithColor(color) {
        ctx.fillStyle = 'rgb(' + color.join(',') + ')';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    document.getElementById('getColorButton').addEventListener('click', function() {
        var avgColor = getAverageColor();
        fillCanvasWithColor(avgColor);
    });

    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mousemove', draw);

    // Add event listeners for touch events
    canvas.addEventListener('touchstart', function(e) {
        e.preventDefault();
        startDraw(e.touches[0]);
    }, false);
    canvas.addEventListener('touchend', function(e) {
        e.preventDefault();
        endDraw();
    }, false);
    canvas.addEventListener('touchmove', function(e) {
        e.preventDefault();
        draw(e.touches[0]);
    }, false);

</script>

</body>
</html>
